/*!
 * hx-analytics jssdk v1.0.0
 * (c) 2018-2019
 * author: pr1mavera
 * email: pr1mavera.w4ng@gmail.com
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).ha=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(t,e,n){return(i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&o(i,n.prototype),i}).apply(null,arguments)}function s(t){var e="function"==typeof Map?new Map:void 0;return(s=function(t){if(null===t||!function(t){return-1!==Function.toString.call(t).indexOf("[native code]")}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return i(t,arguments,r(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,t)})(t)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],r=!0,o=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(r=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function a(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function f(t){var e=t.getBoundingClientRect(),n=document.body,r=document.documentElement,o=window.pageYOffset||r.scrollTop||n.scrollTop,i=window.pageXOffset||r.scrollLeft||n.scrollLeft,s=r.clientTop||n.clientTop||0,c=r.clientLeft||n.clientLeft||0,u=e.top+o-s,a=e.left+i-c;return{top:Math.round(u),left:Math.round(a)}}function l(){}var p,h=window.document,d=p=function(t){this.options=Object.assign({},{draw:!0,simpleId:!0},t),this.lastClick=document.body;var e=this;document.addEventListener("mousedown",(function(t){e.lastClick=t.target,e.focusedElement!==e.lastClick&&p.prototype.clean()}))},y=d.prototype;function b(){}y.getUniqueId=function(t,e){if(!((t=t||this.lastClick)instanceof HTMLElement))return console.error("input is not a HTML element"),{};var n={wid:"",type:"",top:f(t).top,left:f(t).left,viewLeft:t.getBoundingClientRect().left,viewTop:t.getBoundingClientRect().top,text:t.innerText},r=t.id,o=t.name,i=t.tagName.toLowerCase(),s=t.type?t.type.toLowerCase():"",c="",u=t.classList||[];if(u.forEach((function(t){c+="."+t})),"body"!==i&&"html"!==i||(n.wid=i,n.type=i),r&&h.getElementById(r)===t){var a=new RegExp("^[a-zA-Z]+");!e&&this.options.simpleId?n.wid=r:a.test(r)&&(n.wid=i+"#"+r),n.type="document.getElementById()"}if(!n.wid&&o&&h.getElementsByName(o)[0]===t&&(n.wid=o,n.type="document.getElementsByName()"),!n.wid&&c&&h.querySelector(i+c)===t){n.wid=i+c,n.type="document.querySelector()";var l=u.length;if(2<l){for(var p=1,b=[];Math.pow(2,p)<l;)b.push(Math.pow(2,p)),p++;b.push(l);for(var g=0;g<b.length;g++)b[g]}}if("radio"===s){var m=i+"[value='"+t.value+"']";o&&(m+="[name='"+o+"']"),h.querySelector(m)===t&&(n.wid=m,n.type="document.querySelector()")}if(n.wid||(m=i,m=c?m+c:m,m=o?m+"[name='"+o+"']":m,y.getTarget(m)===t&&(n.wid=m,n.type="document.querySelector()")),!n.wid){m=i,m=c?m+c:m;var v=h.querySelectorAll(m);if(v&&0<v.length){for(var w=null,_=0;_<v.length;_++)if(t===v[_]){w=_+1;break}w&&(m=m+":nth-child("+w+")",h.querySelector(m)===t&&(n.wid=m,n.type="document.querySelector()"))}}if(!n.wid){if(!t.parentNode)return;var E=d.prototype.getUniqueId(t.parentNode,!0),S=E?E.wid:"";if(!S)return{wid:"",type:"NO_LOCATION"};var O=i;if(c&&(O+=c),m=S+">"+O,1<h.querySelectorAll(m).length){w=m=null;for(var T=0;T<t.parentNode.children.length;T++)if(t.parentNode.children[T]===t){w=T+1;break}1<=w&&(m=S+">"+O+":nth-child("+w+")",h.querySelector(m)!=t&&(m=null))}n.wid=m,n.type="document.querySelector()"}return this.focusedElement=y.getTarget(n.wid),!e&&this.options.draw&&this.__proto__.draw(n),n},y.getTarget=function(t){return h.getElementById(t)||h.getElementsByName(t)[0]||h.querySelector(t)},y.clean=l,y.draw=l;var g=(window.whatsElement=d).default;b.unboundMethod=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2;return this.curry((function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var o=n.pop();return o[t].apply(o,n)}),e)},b.curry=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t.length;return function n(){for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];var c=[].concat(o,i);return c.length>=e?t.apply(void 0,a(c)):n.apply(void 0,a(c))}}()},b.map=b.unboundMethod("map",2);var m=window,v=m.sessionStorage,w=m.localStorage,_=u(b.map((function(t){return{get:function(e){return JSON.parse(t.getItem(e))},set:function(e,n){return t.setItem(e,JSON.stringify(n))},remove:function(e){return t.removeItem(e)},clear:function(){return t.clear()}}}))([v,w]),2),E=_[0],S=_[1];b.SessStorage=E,b.LocStorage=S,b.inIframe=function(){return window&&window.self!==window.top},b.isType=function(t,e){return Object.prototype.toString.call(e)==="[object ".concat(t,"]")},b.createVisitId=function(t){return""+t+this.formatDate("yyyy-MM-dd-hh-mm-ss").split(/-/g).join("")+this.randomInRange(1e5,999999)},b.formatDate=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Date,n={M:e.getMonth()+1,d:e.getDate(),h:e.getHours(),m:e.getMinutes(),s:e.getSeconds(),q:Math.floor((e.getMonth()+3)/3)};return t.replace(/([yMdhmsqS])+/g,(function(t,r){var o=n[r];if(void 0!==o)return 1<t.length&&(o=(o="0"+o).substr(o.length-2)),o;if("y"===r)return(e.getFullYear()+"").substr(4-t.length);if("S"!==r)return t;var i="00".concat(e.getMilliseconds());return i.substr(i.length-3)}))},b.randomInRange=function(t,e){return Math.floor(Math.random()*(e-t)+t)},b.getElemId=function(t,e,n){try{var r=(new g).getUniqueId(n),o=r.type,i=r.wid;return"".concat(i,"!").concat(o,"!").concat(t,"!").concat(e)}catch(t){return null}},b.getElem=function(t){return document.getElementById(t)||document.getElementsByName(t)[0]||document.querySelector(t)},b.mixins=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){Object.assign.apply(Object,[t.prototype].concat(e))}},b.reloadConstructor=function(t){return function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e}(t)};var O=function(){function t(t){this.modeType="browse"}var e=t.prototype;return e.onEnter=function(){},e.onExit=function(){},e.onTrigger=function(){console.log("\u70b9\u5427~\u8001\u5f1f\u55f7~\u6211\u6d4f\u89c8\u6a21\u5f0f\u5565\u4e5f\u4e0d\u4f1a\u5e72\u7684~")},t}(),T=function(){function t(t){this.modeType="setting",this.events=t,this.subs=[]}var e=t.prototype;return e.onEnter=function(){for(var t in this)if(t.startsWith(this.modeType)){var e=u(this[t],2),n=e[0],r=e[1];this.subs.push(r.call(this,n))}this.DomMasker=new x},e.onExit=function(){this.subs.length&&this.subs.forEach((function(t){return t.unsubscribe()})),this.subs=[],this.DomMasker.clear()},e.onTrigger=function(t){console.log("SettingLifeCycle onTrigger"),window.parent.postMessage(t,"*")},t}();T=function(e,n,r,o){var i,s=arguments.length,c=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"===("undefined"==typeof Reflect?"undefined":t(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,n,r,o);else for(var u=e.length-1;0<=u;u--)(i=e[u])&&(c=(s<3?i(c):3<s?i(n,r,c):i(n,r))||c);return 3<s&&c&&Object.defineProperty(n,r,c),c}([b.mixins({"setting-click":[{capture:!1},function(t){var e=this;return this.events.click(t).subscribe((function(t){e.onTrigger(t)}))}],"setting-reset":[{},function(){var t=this;return this.events.messageOf("reset").subscribe((function(){t.domMasker.reset()}))}],"setting-preset":[{},function(){var t=this;return this.events.messageOf("preset").subscribe((function(e){t.domMasker.preset(e.data.presetPoints)}))}]}),function(e,n){if("object"===("undefined"==typeof Reflect?"undefined":t(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)}("design:paramtypes",[Object])],T);var x=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];if(!t.instance){var n=window.innerWidth,r=window.innerHeight;this.canvas=new R(n,r),this.tempCanvas=new R(n,r),document.body.appendChild(this.canvas),t.instance=this}return this.preset(e),this.canvas.getContext("2d").drawImage(this.tempCanvas,0,0),t.instance}var e=t.prototype;return e.preset=function(t){var e=this;this.tempCanvas.clear(),this.points=t.map((function(t){return new j(t.pid)}));var n=this.tempCanvas.getContext("2d");this.points.forEach((function(t){e.render(n,t.getRect())}))},e.clear=function(){this.canvas.clear()},e.reset=function(){},e.onCatch=function(){},e.render=function(t,e){},t}(),j=function(){function t(t){this.pid=t}var e=t.prototype;return e.getRect=function(){var t=this.pid.split("!")[0],e=b.getElem(t),n=e.clientWidth,r=e.clientHeight,o=e.scrollHeight,i=e.scrollWidth,s=e.offsetTop;return[e.offsetLeft-i,s-o,n,r]},e.draw=function(t){},t}(),R=function(t){function e(e,n){var r;return(r=t.call(this)||this).width=r.w=e,r.height=r.h=n,r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.zIndex="9999",r.style.pointerEvents="none",c(r)||c(r)}return n(e,t),e.prototype.clear=function(){this.getContext("2d").clearRect(0,0,this.w,this.h)},e}(s(HTMLCanvasElement)),M=function(){function t(t){this.modeType="report",this.events=t,this.subs=[]}var e=t.prototype;return e.onEnter=function(){for(var t in console.log(this),this)if(t.startsWith(this.modeType)){var e=u(this[t],2),n=e[0],r=e[1];this.subs.push(r.call(this,n))}},e.onExit=function(){this.subs.length&&this.subs.forEach((function(t){return t.unsubscribe()})),this.subs=[]},e.onTrigger=function(t){console.log("ReportLifeCycle onTrigger: ",t)},e.formatDatagram=function(){},t}();M=function(e,n,r,o){var i,s=arguments.length,c=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"===("undefined"==typeof Reflect?"undefined":t(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,n,r,o);else for(var u=e.length-1;0<=u;u--)(i=e[u])&&(c=(s<3?i(c):3<s?i(n,r,c):i(n,r))||c);return 3<s&&c&&Object.defineProperty(n,r,c),c}([b.mixins({"report-click":[{capture:!1},function(t){var e=this;return this.events.click(t).subscribe((function(t){e.onTrigger(t)}))}]}),function(e,n){if("object"===("undefined"==typeof Reflect?"undefined":t(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)}("design:paramtypes",[Object])],M);var A=function(t,e){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function P(t,e){function n(){this.constructor=t}A(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function C(t){return"function"==typeof t}var L=!1,I={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack,L=t},get useDeprecatedSynchronousErrorHandling(){return L}};function k(t){setTimeout((function(){throw t}),0)}var D={closed:!0,next:function(t){},error:function(t){if(I.useDeprecatedSynchronousErrorHandling)throw t;k(t)},complete:function(){}},H=Array.isArray||function(t){return t&&"number"==typeof t.length},q=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),N=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n,r=this._parentOrParents,o=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof t)r.remove(this);else if(null!==r)for(var s=0;s<r.length;++s)r[s].remove(this);if(C(o))try{o.call(this)}catch(n){e=n instanceof q?B(n.errors):[n]}if(H(i)){s=-1;for(var c=i.length;++s<c;){var u=i[s];if(null!==(n=u)&&"object"==typeof n)try{u.unsubscribe()}catch(n){e=e||[],n instanceof q?e=e.concat(B(n.errors)):e.push(n)}}}if(e)throw new q(e)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var r=n;(n=new t)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var o=n._parentOrParents;if(null===o)n._parentOrParents=this;else if(o instanceof t){if(o===this)return n;n._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return n;o.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[n]:i.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.EMPTY=((e=new t).closed=!0,e),t}();function B(t){return t.reduce((function(t,e){return t.concat(e instanceof q?e.errors:e)}),[])}var U="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),V=function(t){function e(n,r,o){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=D;break;case 1:if(!n){i.destination=D;break}if("object"==typeof n){n instanceof e?(i.syncErrorThrowable=n.syncErrorThrowable,(i.destination=n).add(i)):(i.syncErrorThrowable=!0,i.destination=new W(i,n));break}default:i.syncErrorThrowable=!0,i.destination=new W(i,n,r,o)}return i}return P(e,t),e.prototype[U]=function(){return this},e.create=function(t,n,r){var o=new e(t,n,r);return o.syncErrorThrowable=!1,o},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(N),W=function(t){function e(e,n,r,o){var i,s=t.call(this)||this;s._parentSubscriber=e;var c=s;return C(n)?i=n:n&&(i=n.next,r=n.error,o=n.complete,n!==D&&(C((c=Object.create(n)).unsubscribe)&&s.add(c.unsubscribe.bind(c)),c.unsubscribe=s.unsubscribe.bind(s))),s._context=c,s._next=i,s._error=r,s._complete=o,s}return P(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;I.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=I.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?this.__tryOrSetError(e,this._error,t):this.__tryOrUnsub(this._error,t),this.unsubscribe();else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):k(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;k(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};I.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,n):this.__tryOrUnsub(n),this.unsubscribe()}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),I.useDeprecatedSynchronousErrorHandling)throw t;k(t)}},e.prototype.__tryOrSetError=function(t,e,n){if(!I.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(e){return I.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0):(k(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(V),z="function"==typeof Symbol&&Symbol.observable||"@@observable";function Y(){}var F=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator,o=function(t,e,n){if(t){if(t instanceof V)return t;if(t[U])return t[U]()}return t||e||n?new V(t,e,n):new V(D)}(t,e,n);if(r?o.add(r.call(o,this.source)):o.add(this.source||I.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),I.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){I.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){var e=t,n=e.closed,r=e.destination,o=e.isStopped;if(n||o)return!1;t=r&&r instanceof V?r:null}return!0}(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=J(e))((function(e,r){var o;o=n.subscribe((function(e){try{t(e)}catch(e){r(e),o&&o.unsubscribe()}}),r,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[z]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:function(t){return t?1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}:Y}(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=J(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function J(t){if(!(t=t||Promise))throw new Error("no Promise impl found");return t}var X=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new Z(t,this.project,this.thisArg))},t}(),Z=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.project=n,o.count=0,o.thisArg=r||o,o}return P(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(V);function G(t,e,n,r){return C(n)&&(r=n,n=void 0),r?G(t,e,n).pipe(function(t,e){return function(e){return e.lift(new X(t,void 0))}}((function(t){return H(t)?r.apply(void 0,t):r(t)}))):new F((function(r){!function t(e,n,r,o,i){var s,c,u,a;if((a=e)&&"function"==typeof a.addEventListener&&"function"==typeof a.removeEventListener){var f=e;e.addEventListener(n,r,i),s=function(){return f.removeEventListener(n,r,i)}}else if((u=e)&&"function"==typeof u.on&&"function"==typeof u.off){var l=e;e.on(n,r),s=function(){return l.off(n,r)}}else if((c=e)&&"function"==typeof c.addListener&&"function"==typeof c.removeListener){var p=e;e.addListener(n,r),s=function(){return p.removeListener(n,r)}}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var h=0,d=e.length;h<d;h++)t(e[h],n,r,o,i)}o.add(s)}(t,e,(function(t){1<arguments.length?r.next(Array.prototype.slice.call(arguments)):r.next(t)}),r,n)}))}function K(){return G(window,"message")}function Q(t){return K().pipe(function(t,e){return function(e){return e.lift(new $(t,void 0))}}((function(e){return e.data.tag===t})))}var $=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new tt(t,this.predicate,this.thisArg))},t}(),tt=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.predicate=n,o.thisArg=r,o.count=0,o}return P(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(V),et=Object.freeze({click:function(t){return G(document,"click",t)},mousemove:function(t){return G(document,"mousemove",t)},load:function(){return G(document,"load")},beforeUnload:function(){return G(document,"beforeunload")},hashchange:function(){return G(document,"hashchange")},popstate:function(){return G(document,"popstate")},visibilitychange:function(){return G(document,"visibilitychange")},online:function(){return G(document,"online")},offline:function(){return G(document,"offline")},message:K,messageOf:Q});return new(function(){function t(t){var e=this,n=t.mode;this.modeContainer=n,this.mode=b.inIframe()?"browse":"report",this._mode.onEnter(),Q("mode").subscribe((function(t){e.mode=t.data.mode,e._mode.onEnter(t.data.points)}))}var n=t.prototype;return n.push=function(t){this._mode.onTrigger(t)},n.init=function(){return this},function(t,n,r){n&&e(t.prototype,n)}(t,[{key:"mode",get:function(){return this._mode?this._mode.modeType:null},set:function(t){this.mode!==t&&(this._mode=this.modeContainer[t])}}]),t}())({mode:{browse:new O,report:new M(et),setting:new T(et)}})}));