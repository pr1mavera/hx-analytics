---
title: 事件上报流程
---

## 相关接口说明
### Report
### MsgsQueue
### ReportStrategy
+ 消费者存在两种消费方式，两种消费方式都是有效的
    1. 远程服务
    2. 本地缓存
+ 当客户端网络状态发生变化时，会切换消费方式（联网远程服务，断网本地缓存）
+ 当上报至远程服务失败时，会将数据暂时缓存在本地缓存
本地缓存的数据
### PageTracer

## 事件上报模式整体流程
1. 绑定模块  
    转换至事件上报模式（Report）之后，绑定以下模块：
    + 宿主事件模块（AppEvent）
    + 事件上报策略模块（ReportStrategy）
    + 消息队列模块（MsgsQueue）
    + 页面记录跟踪模块（PageTracer）
2. 用户行为触发事件监控，包装数据推送至消息队列  
    宿主环境用户行为事件产生，进过对应事件的中间件包装数据字典（js对象，包含该事件属性），触发 Report.onTrigger 包装成一份数据报，通过 MsgsQueue.push 推送至消息队列
3. 消息队列推送消息至消费者（事件上报策略）消费数据  
    MsgsQueue.push 接口为一个节流器，节流时长为两秒（可通过系统配置），每次触发两秒之后会将消息队列中的消息全部提交至消费者消费
4. 消费者根据当前消费策略
    消费者会根据当前的消费策略（远程服务、本地缓存）消费数据，当上报至远程服务失败时，会将数据暂时缓存在本地缓存
    
